vc.bl$block[i]<-5
}
}
return(vc.bl)
}
###########################
## read in raw file
raw<-read.csv('TIME1.csv')
## make plot dataframe
# extract the plot numbers from raw file
plot.code<-scrub.TEM(raw$ID)
# plot dataframe
plot<-data.frame(plot_id=unique(plot.code$code),field_season_id=1,site_id=1,block=1,treatment_id=1)
# add block numbers
plot$block<-block.TEM(plot$plot_id)[,2]
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
rm(list=ls())
##### Cleaning code for TIME1 ####
### set working directory
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/BEND1/RAW")
field_season<-data.frame(field_season_id=1,project_id=1,year=c(2014,2015,2016,2017),crew=c("HaoRanLin_MargaretMayfield","HaoRanLin_LoyXingwen","MaiaRaymundo","MaiaRaymundo")
## site dataframe
site<-data.frame(site_id=1,site="perenjori",area="3.5",units="km.sq",lat=0,long=0,max_temp=20.0,min_temp=7.5,ann_precip=298.3)
## treatment dataframe
treatment<-data.frame(treatment_id=1,treatment="control")
########################
##### function to scrub TEM's H###D### plot id code #####
scrub.TEM<- function(x) {
den<-sapply(strsplit(as.character(x),"D"),"[[",2)
code.scrub<-gsub("H","",x=as.character(x))
code<-sapply(strsplit(gsub("D","_",code.scrub),"_"),"[[",1)
dm<-data.frame(cbind(den,code))
return(dm) }
###########################
##### function to add block id ####
block.TEM<- function(x) {
vc.bl<-data.frame(plot=as.numeric(x),block=0)
for (i in 1:length(x)) {
pt<-vc.bl$plot[i]
if(findInterval(pt,c(1,21))==T) {
vc.bl$block[i]<-1
}
else if(findInterval(pt,c(21,41))==T) {
vc.bl$block[i]<-2
}
else if(findInterval(pt,c(41,61))==T) {
vc.bl$block[i]<-3
}
else if(findInterval(pt,c(61,81))==T) {
vc.bl$block[i]<-4
}
else if(findInterval(pt,c(81,101))==T) {
vc.bl$block[i]<-5
}
}
return(vc.bl)
}
###########################
## read in raw file
raw<-read.csv('TIME1.csv')
## make plot dataframe
# extract the plot numbers from raw file
plot.code<-scrub.TEM(raw$ID)
# plot dataframe
plot<-data.frame(plot_id=unique(plot.code$code),field_season_id=1,site_id=1,block=1,treatment_id=1)
# add block numbers
plot$block<-block.TEM(plot$plot_id)[,2]
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
field_season<-data.frame(field_season_id=1,project_id=1,year=c(2014,2015,2016,2017),crew=c("HaoRanLin_MargaretMayfield","HaoRanLin_LoyXingwen","MaiaRaymundo","MaiaRaymundo"))
field_season
field_season<-data.frame(field_season_id=1,project_id=1,year=c(2014,2015,2016,2017),crew=c("HaoRanLin_MargaretMayfield_XingwenLoy_EmmaLodourceur_JohnPark_ClaireWainwright_AlexanderNance_LeanderLoveAnderegg","HaoRanLin_XingwenLoy","MaiaRaymundo","MaiaRaymundo"))
field_season
field_season<-data.frame(field_season_id=1,project_id=1,year=c(2014,2015,2016,2017),crew=c("HaoRanLin_MargaretMayfield_XingwenLoy_JohnPark_ClaireWainwright_AlexanderNance_LeanderLoveAnderegg","HaoRanLin_XingwenLoy","MaiaRaymundo","MaiaRaymundo"))
rm(list=ls())
##### Cleaning code for TIME1 ####
### set working directory
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/RAW")
## projects dataframe
projects<-data.frame(project_id=1,researcher="Trace_Martyn",email="t.martyn@uq.net.au",study_sites="perenjori")
## field_season dataframe
field_season<-data.frame(field_season_id=1,project_id=1,year=2016,crew="TraceMartyn_JulieGuenat_MargaretMayfield")
## site dataframe
site<-data.frame(site_id=1,site="perenjori",area=3.5,units="km.sq",lat=0,long=0,max_temp=20.0,min_temp=7.5,ann_precip=298.3)
## treatment dataframe
treatment<-data.frame(treatment_id=1,treatment="control")
########################
##### function to scrub TEM's H###D### plot id code #####
scrub.TEM<- function(x) {
den<-sapply(strsplit(as.character(x),"D"),"[[",2)
code.scrub<-gsub("H","",x=as.character(x))
code<-sapply(strsplit(gsub("D","_",code.scrub),"_"),"[[",1)
dm<-data.frame(cbind(den,code))
return(dm) }
###########################
##### function to add block id ####
block.TEM<- function(x) {
vc.bl<-data.frame(plot=as.numeric(x),block=0)
for (i in 1:length(x)) {
pt<-vc.bl$plot[i]
if(findInterval(pt,c(1,21))==T) {
vc.bl$block[i]<-1
}
else if(findInterval(pt,c(21,41))==T) {
vc.bl$block[i]<-2
}
else if(findInterval(pt,c(41,61))==T) {
vc.bl$block[i]<-3
}
else if(findInterval(pt,c(61,81))==T) {
vc.bl$block[i]<-4
}
else if(findInterval(pt,c(81,101))==T) {
vc.bl$block[i]<-5
}
}
return(vc.bl)
}
###########################
## read in raw file
raw<-read.csv('TIME1.csv')
## make plot dataframe
# extract the plot numbers from raw file
plot.code<-scrub.TEM(raw$ID)
# plot dataframe
plot<-data.frame(plot_id=unique(plot.code$code),field_season_id=1,site_id=1,block=1,treatment_id=1)
# add block numbers
plot$block<-block.TEM(plot$plot_id)[,2]
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
treatment<-data.frame(treatment_id=c(1,2,3,4,5,6),treatment=c("OpenDry","OpenWet","ControlDry","ControlWet","LidDry","LidWet"))
raw<-read.csv('bend_box2014.csv')
d
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/BEND1/RAW")
raw<-read.csv('bend_box2014.csv')
raw<-read.csv('bend_box2014_2015.csv')
raw<-read.csv('bend_box2014_2015.csv')
plot<-raw$unique.plot
length(unique(raw$unique.plot)
)
plot<-data.frame(plot_id=seq(1,length(unique(raw$unique.plot))),field_season_id=1,site_id=1,block=NA,treatment_id=1)
plot
treatment
for (i in 1:length(raw$year)) {
ex<-raw$exclusion[i]
wat<-raw$water[i]
if (ex=="c" & wat=="w") {raw$treatment[i]<-4}
else if (ex=="o" & wat=="w") {raw$treatment[i]<-2}
else if (ex=="k" & wat=="w") {raw$treatment[i]<-6}
else if (ex=="c" & wat=="d") {raw$treatment[i]<-3}
else if (ex=="o" & wat=="d") {raw$treatment[i]<-1}
else if (ex=="k" & wat=="d") {raw$treatment[i]<-5}
}
head(raw)
raw
plot<-data.frame(plot_id=seq(1,length(unique(raw$unique.plot))),field_season_id=1,site_id=1,block=1,treatment_id=1)
grpl("#",raw$unique.plot)
grepl("#",raw$unique.plot)
unlist(strsplit(gsub("[^0-9]", "", unlist(raw$unique.plot)), "")
## make plot dataframe
# plot dataframe
plot<-data.frame(plot_id=seq(1,length(unique(raw$unique.plot))),field_season_id=1,site_id=1,block=1,treatment_id=1)
# add block numbers
plot$block<-block.TEM(plot$plot_id)[,2]
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
unlist(strsplit(gsub("[^0-9]", "", unlist(raw$unique.plot)), ""))
unique(na.omit(as.numeric(unlist(strsplit(unlist(raw$unique.plot), "[^0-9]+")))))
grepexpr("[0-9]+",raw$unique.plot)
gregexpr("[0-9]+",raw$unique.plot)
temp2<-gregexpr("[0-9]+", raw$unique.plot)
as.numeric(unique(unlist(regmatches(raw$unique.plot, temp2))))
tmemp2
temp2
unique(na.omit(as.numeric(unlist(strsplit(unlist(raw$unique.plot), "[^0-9]+")))))
unlist(strsplit(gsub("[^0-9]+", "", unlist(raw$unique.plot)), ""))
unlist(strsplit(gsub("[0-9]+", "", unlist(raw$unique.plot)), ""))
unlist(strsplit(gsub("[^0-9]+", "", unlist(raw$unique.plot)), ""))
strsplit(raw$unique.plot,"[^[:digit:]]")
strsplit(raw$unique.plot,"[^0-9")
strsplit(AS.CHARACTER(raw$unique.plot),"[^[:digit:]]")
strsplit(as.character(raw$unique.plot),"[^[:digit:]]")
as.numeric(unlist(strsplit(as.character(raw$unique.plot),"[^[:digit:]]")))
uniques(as.numeric(unlist(strsplit(as.character(raw$unique.plot),"[^[:digit:]]"))))
unique(as.numeric(unlist(strsplit(as.character(raw$unique.plot),"[^[:digit:]]"))))
temp2<-gregexpr("[0-9]+", raw$unique.plot)
as.numeric(unique(unlist(regmatches(raw$unique.plot, temp2))))
temp2<-gregexpr("[0-9]+", raw$unique.plot)
as.numeric(unique(unlist(regmatches(raw$unique.plot, temp2))))
sapply(raw$unique.plot, function(k) strsplit(k, "[^0-9]"))
sapply(as.character(raw$unique.plot), function(k) strsplit(k, "[^0-9]"))
sapply(as.character(raw$unique.plot), function(k) unlist(strsplit(k, "[^0-9]")))
sapply(as.character(raw$unique.plot), function(k) as.numeric(unlist(strsplit(k, "[^0-9]"))))
strsplit(k, "[^0-9]")
sapply(as.character(raw$unique.plot), function(k) strsplit(k, "[^0-9]"))
unlist(m)
m<-sapply(as.character(raw$unique.plot), function(k) strsplit(k, "[^0-9]"))
unlist(m)
as.numeric(unlist(m))
unique(col[!is.na(sol)])
sol<-as.numeric(unlist(m))
unique(col[!is.na(sol)])
class(sol)
unique(sol[!is.na(sol)])
sol[!is.na(sol)]
BEND.block<- function (x) {
m<-sapply(as.character(x), function(k) strsplit(k, "[^0-9]"))
sol<-as.numeric(unlist(m))
retun(sol[!is.na(sol)])
}
BEND.bleck(raw$unique.plot)
BEND.block(raw$unique.plot)
BEND.block<- function (x) {
m<-sapply(as.character(x), function(k) strsplit(k, "[^0-9]"))
sol<-as.numeric(unlist(m))
return(sol[!is.na(sol)])
}
BEND.block(raw$unique.plot)
raw$block.num<-BEND.block(raw$unique.plot)
raw.plot<-data.frame(block=raw$block,exclsuion=raw$exclusion,water=raw$water,unique.plot=raw$unique.plot)
raw.plot
raw.plot<-raw.plot[!duplicated(raw.plot),]
raw.plot
raw.plot<-block.num<-BEND.block(raw.plot$unique.plot)
raw.plot
raw.plot<-data.frame(block=raw$block,exclsuion=raw$exclusion,water=raw$water,unique.plot=raw$unique.plot)
raw.plot<-raw.plot[!duplicated(raw.plot),]
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
raw.plot
BEND.treatment<- function (x,w) {
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment[i]<-4}
else if (ex=="o" & wat=="w") {treatment[i]<-2}
else if (ex=="k" & wat=="w") {treatment[i]<-6}
else if (ex=="c" & wat=="d") {treatment[i]<-3}
else if (ex=="o" & wat=="d") {treatment[i]<-1}
else if (ex=="k" & wat=="d") {treatment[i]<-5}
return (treatment.ew)
}
BEND.treatment<- function (x,w) {
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment[i]<-4}
else if (ex=="o" & wat=="w") {treatment[i]<-2}
else if (ex=="k" & wat=="w") {treatment[i]<-6}
else if (ex=="c" & wat=="d") {treatment[i]<-3}
else if (ex=="o" & wat=="d") {treatment[i]<-1}
else if (ex=="k" & wat=="d") {treatment[i]<-5}
}
return (treatment.ew)
}
XX<-BEND.treatment(raw.plot$exclsuion,raw.plot$water)
XX
i
i<-1
x<-raw.plot$exclsuion
w<-raw.plot$water
x
w
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment[i]<-4}
else if (ex=="o" & wat=="w") {treatment[i]<-2}
else if (ex=="k" & wat=="w") {treatment[i]<-6}
else if (ex=="c" & wat=="d") {treatment[i]<-3}
else if (ex=="o" & wat=="d") {treatment[i]<-1}
else if (ex=="k" & wat=="d") {treatment[i]<-5}
}
return (treatment.ew)
treatment.ew
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment.ew[i]<-4}
else if (ex=="o" & wat=="w") {treatment.ew[i]<-2}
else if (ex=="k" & wat=="w") {treatment.ew[i]<-6}
else if (ex=="c" & wat=="d") {treatment.ew[i]<-3}
else if (ex=="o" & wat=="d") {treatment.ew[i]<-1}
else if (ex=="k" & wat=="d") {treatment.ew[i]<-5}
}
BEND.treatment<- function (x,w) {
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment.ew[i]<-4}
else if (ex=="o" & wat=="w") {treatment.ew[i]<-2}
else if (ex=="k" & wat=="w") {treatment.ew[i]<-6}
else if (ex=="c" & wat=="d") {treatment.ew[i]<-3}
else if (ex=="o" & wat=="d") {treatment.ew[i]<-1}
else if (ex=="k" & wat=="d") {treatment.ew[i]<-5}
}
return (treatment.ew)
}
raw.plot$treatment<-BEND.treatment(raw.plot$exclsuion,raw.plot$water)
raw.plot
raw.plot$block.num<-BEND.block(raw$unique.plot)
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
## read in raw file
raw<-read.csv('bend_box2014_2015.csv')
raw.plot<-data.frame(block=raw$block,exclsuion=raw$exclusion,water=raw$water,unique.plot=raw$unique.plot)
raw.plot<-raw.plot[!duplicated(raw.plot),]
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
raw.plot$treatment<-BEND.treatment(raw.plot$exclsuion,raw.plot$water)
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
## make plot dataframe
raw.plot
plot<-data.frame(plot_id=seq(1,length(unique(raw.plot$unique.plot))),field_season_id=1,site_id=1,block=raw.plot$block.num,treatment_id=raw.plot$treatment)
plot
raw.plot<-data.frame(exclsuion=raw$exclusion,water=raw$water,unique.plot=raw$unique.plot)
raw.plot<-raw.plot[!duplicated(raw.plot),]
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
plot<-data.frame(plot_id=seq(1,length(unique(raw.plot$unique.plot))),field_season_id=1,site_id=1,block=raw.plot$block.num,treatment_id=raw.plot$treatment)
rm(list=ls())
##### Cleaning code for TIME1 ####
### set working directory
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/BEND1/RAW")
## projects dataframe
projects<-data.frame(project_id=1,researcher="MaiaRaymundo",email="raymundo.mlh@gmail.com",study_sites="bendering")
## field_season dataframe
field_season<-data.frame(field_season_id=1,project_id=1,year=c(2014,2015,2016,2017),crew=c("HaoRanLin_MargaretMayfield_XingwenLoy_EmmaLodourceur_JohnPark_ClaireWainwright_AlexanderNance_LeanderLoveAnderegg","HaoRanLin_XingwenLoy","MaiaRaymundo","MaiaRaymundo"))
## site dataframe
site<-data.frame(site_id=1,site="bendering",area=1602,units="ha",lat=0,long=0,max_temp=24.3,min_temp=9.4,ann_precip=361.3)
## treatment dataframe
treatment<-data.frame(treatment_id=c(1,2,3,4,5,6),treatment=c("OpenDry","OpenWet","ControlDry","ControlWet","LidDry","LidWet"))
## Below are various codes use here and in the raw files for the treatments
#Wet = w "Wet"
#Dry = d "Dry"
#Open = o "Open"
#Control/Wall = c "Control"
#Wall+Lid = k "Lid
########################
BEND.treatment<- function (x,w) {
treatment.ew<-vector()
for (i in 1:length(x)) {
ex<-x[i]
wat<-w[i]
if (ex=="c" & wat=="w") {treatment.ew[i]<-4}
else if (ex=="o" & wat=="w") {treatment.ew[i]<-2}
else if (ex=="k" & wat=="w") {treatment.ew[i]<-6}
else if (ex=="c" & wat=="d") {treatment.ew[i]<-3}
else if (ex=="o" & wat=="d") {treatment.ew[i]<-1}
else if (ex=="k" & wat=="d") {treatment.ew[i]<-5}
}
return (treatment.ew)
}
### function to extract block number out of the unique plot name
BEND.block<- function (x) {
m<-sapply(as.character(x), function(k) strsplit(k, "[^0-9]"))
sol<-as.numeric(unlist(m))
return(sol[!is.na(sol)])
}
###########
## read in raw file
raw<-read.csv('bend_box2014_2015.csv')
# make smaller dataframe without extranious values
raw.plot<-data.frame(exclsuion=raw$exclusion,water=raw$water,unique.plot=raw$unique.plot)
# remove duplicate values
raw.plot<-raw.plot[!duplicated(raw.plot),]
# add block number
raw.plot$block.num<-BEND.block(raw.plot$unique.plot)
# add treatment values
raw.plot$treatment<-BEND.treatment(raw.plot$exclsuion,raw.plot$water)
## make plot dataframe
# plot dataframe
plot<-data.frame(plot_id=seq(1,length(unique(raw.plot$unique.plot))),field_season_id=1,site_id=1,block=raw.plot$block.num,treatment_id=raw.plot$treatment)
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/BEND1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/RAW")
## projects dataframe
projects<-data.frame(project_id=1,researcher="Trace_Martyn",email="t.martyn@uq.net.au",study_sites="perenjori")
## field_season dataframe
field_season<-data.frame(field_season_id=1,project_id=1,year=2016,crew="TraceMartyn_JulieGuenat_MargaretMayfield")
## site dataframe
site<-data.frame(site_id=1,site="perenjori",area=3.5,units="km.sq",lat=0,long=0,max_temp=20.0,min_temp=7.5,ann_precip=298.3)
## treatment dataframe
treatment<-data.frame(treatment_id=1,treatment="control")
##### function to scrub TEM's H###D### code for plot id number #####
scrub.TEM<- function(x) {
den<-sapply(strsplit(as.character(x),"D"),"[[",2)
code.scrub<-gsub("H","",x=as.character(x))
code<-sapply(strsplit(gsub("D","_",code.scrub),"_"),"[[",1)
dm<-data.frame(cbind(den,code))
return(dm) }
###########################
##### function to add TEM's block id based on plot.number ####
block.TEM<- function(x) {
vc.bl<-data.frame(plot=as.numeric(x),block=0)
for (i in 1:length(x)) {
pt<-vc.bl$plot[i]
if(findInterval(pt,c(1,21))==T) {vc.bl$block[i]<-1}
else if(findInterval(pt,c(21,41))==T) {vc.bl$block[i]<-2}
else if(findInterval(pt,c(41,61))==T) {vc.bl$block[i]<-3}
else if(findInterval(pt,c(61,81))==T) {vc.bl$block[i]<-4}
else if(findInterval(pt,c(81,101))==T) {vc.bl$block[i]<-5}
}
return(vc.bl)
}
###########################
raw<-read.csv('TIME1.csv')
head(raw)
head(raw)
traits<-c("NumberOfBuds_NumberOfFlowers_NumberOfFruits_MaxHeightmm_ShapeLong_Shape90_MeanLateralShape_ShapeRatio")
traits<-"NumberOfBuds_NumberOfFlowers_NumberOfFruits_MaxHeightmm_ShapeLong_Shape90_MeanLateralShape_ShapeRatio"
trait_summary<-data.frame(field_season_id=1,trait_summary=traits)
trait_summary
# list traits seperated by "_"
traits<-"NumberOfBuds_NumberOfFlowers_NumberOfFruits_MaxHeightmm_ShapeLong_Shape90_MeanLateralShape_ShapeRatio"
trait_summary<-data.frame(field_season_id=1,trait_summary=traits)
head(raw)
######################################
#### Code written by Trace Martyn ####
#### Version 1: 15-06-2017        ####
######################################
rm(list=ls())
##### Cleaning code for TIME1 ####
### set working directory
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/RAW")
## projects dataframe
projects<-data.frame(project_id=1,researcher="Trace_Martyn",email="t.martyn@uq.net.au",study_sites="perenjori")
## field_season dataframe
field_season<-data.frame(field_season_id=1,project_id=1,year=2016,crew="TraceMartyn_JulieGuenat_MargaretMayfield")
## site dataframe
site<-data.frame(site_id=1,site="perenjori",area=3.5,units="km.sq",lat=0,long=0,max_temp=20.0,min_temp=7.5,ann_precip=298.3)
## treatment dataframe
treatment<-data.frame(treatment_id=1,treatment="control")
########################
##### function to scrub TEM's H###D### code for plot id number #####
scrub.TEM<- function(x) {
den<-sapply(strsplit(as.character(x),"D"),"[[",2)
code.scrub<-gsub("H","",x=as.character(x))
code<-sapply(strsplit(gsub("D","_",code.scrub),"_"),"[[",1)
dm<-data.frame(cbind(den,code))
return(dm) }
###########################
##### function to add TEM's block id based on plot.number ####
block.TEM<- function(x) {
vc.bl<-data.frame(plot=as.numeric(x),block=0)
for (i in 1:length(x)) {
pt<-vc.bl$plot[i]
if(findInterval(pt,c(1,21))==T) {vc.bl$block[i]<-1}
else if(findInterval(pt,c(21,41))==T) {vc.bl$block[i]<-2}
else if(findInterval(pt,c(41,61))==T) {vc.bl$block[i]<-3}
else if(findInterval(pt,c(61,81))==T) {vc.bl$block[i]<-4}
else if(findInterval(pt,c(81,101))==T) {vc.bl$block[i]<-5}
}
return(vc.bl)
}
###########################
## read in raw file
raw<-read.csv('TIME1.csv')
## make plot dataframe
# extract the plot numbers from raw file
plot.code<-scrub.TEM(raw$ID)
# plot dataframe
plot<-data.frame(plot_id=unique(plot.code$code),field_season_id=1,site_id=1,block=1,treatment_id=1)
# add block numbers
plot$block<-block.TEM(plot$plot_id)[,2]
## make trait summary dataframe
# look for what traits are available
head(raw)
# list traits seperated by "_"
traits<-"NumberOfBuds_NumberOfFlowers_NumberOfFruits_MaxHeightmm_ShapeLong_Shape90_MeanLateralShape_ShapeRatio"
trait_summary<-data.frame(field_season_id=1,trait_summary=traits)
#####################
## write out csv's
setwd("/home/uqtmart7/data/Dropbox/Mayfield Lab/FunctionalTraitDatabase/Projects/TIME1/CLEAN")
write.csv(projects,"projects.csv",row.names=F)
write.csv(field_season,"field_season.csv",row.names=F)
write.csv(site,"site.csv",row.names=F)
write.csv(treatment,"treatment.csv",row.names=F)
write.csv(plot,"plot.csv",row.names=F)
write.csv(trait_summary,"trait_summary.csv")
